Running experiment on cifar10 with fixed_patch and prompt size 1
Namespace(print_freq=10, save_freq=50, batch_size=128, num_workers=12, epochs=20, square_size=8, optim='sgd', learning_rate=40, weight_decay=0, warmup=1000, momentum=0.9, patience=1000, model='clip', arch='ViT-B/32', method='fixed_patch', prompt_size=1, text_prompt_template='This is a photo of a {}', visualize_prompt=False, root='/scratch/lcur0649', dataset='cifar10', image_size=224, test_noise=False, seed=0, model_dir='./save/models', image_dir='./save/images', filename='fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1', trial=1, resume=None, evaluate=False, gpu=None, use_wandb=False, device='cuda', model_folder='./save/models/fixed_patch_1_cifar10_clip_ViT-B/32_sgd_lr_40_decay_0_bsz_128_warmup_1000_trial_1')
Downloading https://www.cs.toronto.edu/~kriz/cifar-10-python.tar.gz to /scratch/lcur0649/cifar-10-python.tar.gz
  0%|          | 0/170498071 [00:00<?, ?it/s]  0%|          | 65536/170498071 [00:00<08:09, 348046.29it/s]  0%|          | 163840/170498071 [00:00<06:27, 439735.64it/s]  0%|          | 229376/170498071 [00:00<05:38, 503578.08it/s]  0%|          | 327680/170498071 [00:00<04:25, 639794.89it/s]  0%|          | 524288/170498071 [00:00<02:45, 1027451.36it/s]  1%|          | 950272/170498071 [00:00<01:25, 1978354.24it/s]  1%|          | 1835008/170498071 [00:00<00:41, 4016807.91it/s]  2%|▏         | 3145728/170498071 [00:00<00:24, 6717345.50it/s]  3%|▎         | 4718592/170498071 [00:01<00:17, 9392213.59it/s]  4%|▎         | 6291456/170498071 [00:01<00:14, 11209638.64it/s]  5%|▍         | 7995392/170498071 [00:01<00:12, 12930012.18it/s]  6%|▌         | 9830400/170498071 [00:01<00:11, 14529098.91it/s]  7%|▋         | 11698176/170498071 [00:01<00:10, 15709652.16it/s]  8%|▊         | 13697024/170498071 [00:01<00:09, 16983206.39it/s]  9%|▉         | 15859712/170498071 [00:01<00:08, 18327585.25it/s] 11%|█         | 18153472/170498071 [00:01<00:07, 19688663.20it/s] 12%|█▏        | 20480000/170498071 [00:01<00:07, 20672269.40it/s] 14%|█▎        | 23101440/170498071 [00:02<00:06, 22300237.57it/s] 15%|█▌        | 25657344/170498071 [00:02<00:06, 23265705.50it/s] 17%|█▋        | 28246016/170498071 [00:02<00:05, 24048039.07it/s] 18%|█▊        | 31031296/170498071 [00:02<00:05, 25173031.53it/s] 20%|█▉        | 33980416/170498071 [00:02<00:05, 26452582.93it/s] 22%|██▏       | 36995072/170498071 [00:02<00:04, 27542892.62it/s] 23%|██▎       | 40009728/170498071 [00:02<00:04, 28236686.58it/s] 25%|██▌       | 43057152/170498071 [00:02<00:04, 28905717.56it/s] 27%|██▋       | 45973504/170498071 [00:02<00:04, 28828638.19it/s] 29%|██▊       | 48889856/170498071 [00:02<00:04, 28909733.63it/s] 30%|███       | 51806208/170498071 [00:03<00:04, 28983059.61it/s] 32%|███▏      | 54788096/170498071 [00:03<00:03, 28975378.15it/s] 34%|███▍      | 57901056/170498071 [00:03<00:03, 29519830.10it/s] 36%|███▌      | 61046784/170498071 [00:03<00:03, 30000866.91it/s] 38%|███▊      | 64290816/170498071 [00:03<00:03, 30717932.83it/s] 40%|███▉      | 67469312/170498071 [00:03<00:03, 31036012.99it/s] 41%|████▏     | 70582272/170498071 [00:03<00:03, 30930721.89it/s] 43%|████▎     | 73826304/170498071 [00:03<00:03, 30738740.87it/s] 45%|████▌     | 77070336/170498071 [00:03<00:02, 31225284.85it/s] 47%|████▋     | 80216064/170498071 [00:03<00:02, 31175531.31it/s] 49%|████▉     | 83460096/170498071 [00:04<00:02, 30750775.72it/s] 51%|█████     | 86704128/170498071 [00:04<00:02, 31244053.30it/s] 53%|█████▎    | 89849856/170498071 [00:04<00:02, 31200723.78it/s] 55%|█████▍    | 93093888/170498071 [00:04<00:02, 31546073.95it/s] 57%|█████▋    | 96337920/170498071 [00:04<00:02, 31792670.16it/s] 58%|█████▊    | 99549184/170498071 [00:04<00:02, 31705778.36it/s] 60%|██████    | 102727680/170498071 [00:04<00:02, 31299162.94it/s] 62%|██████▏   | 105873408/170498071 [00:04<00:02, 31202745.79it/s] 64%|██████▍   | 109117440/170498071 [00:04<00:01, 31420692.55it/s] 66%|██████▌   | 112263168/170498071 [00:04<00:01, 31250339.20it/s] 68%|██████▊   | 115408896/170498071 [00:05<00:01, 31127285.69it/s] 70%|██████▉   | 118554624/170498071 [00:05<00:01, 31082908.96it/s] 71%|███████▏  | 121700352/170498071 [00:05<00:01, 31027133.32it/s] 73%|███████▎  | 124944384/170498071 [00:05<00:01, 31417472.08it/s] 75%|███████▌  | 128090112/170498071 [00:05<00:01, 30559952.20it/s] 77%|███████▋  | 131334144/170498071 [00:05<00:01, 31104033.01it/s] 79%|███████▉  | 134479872/170498071 [00:05<00:01, 30436553.76it/s] 81%|████████  | 137691136/170498071 [00:05<00:01, 30898830.35it/s] 83%|████████▎ | 140935168/170498071 [00:05<00:00, 30699944.24it/s] 85%|████████▍ | 144146432/170498071 [00:05<00:00, 31103510.29it/s] 86%|████████▋ | 147292160/170498071 [00:06<00:00, 31161358.64it/s] 88%|████████▊ | 150437888/170498071 [00:06<00:00, 30807016.98it/s] 90%|█████████ | 153583616/170498071 [00:06<00:00, 30836509.78it/s] 92%|█████████▏| 156794880/170498071 [00:06<00:00, 31209871.31it/s] 94%|█████████▍| 159940608/170498071 [00:06<00:00, 31133710.14it/s] 96%|█████████▌| 163151872/170498071 [00:06<00:00, 31406391.32it/s] 98%|█████████▊| 166297600/170498071 [00:06<00:00, 31160485.73it/s] 99%|█████████▉| 169443328/170498071 [00:06<00:00, 31216132.31it/s]100%|██████████| 170498071/170498071 [00:06<00:00, 24984400.18it/s]
/home/lcur0649/.conda/envs/dl2022/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 12 worker processes in total. Our suggested max number of worker in current system is 3, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Extracting /scratch/lcur0649/cifar-10-python.tar.gz to /scratch/lcur0649
Files already downloaded and verified
Building custom CLIP
Loading CLIP (backbone: ViT-B/32)
  0%|                                               | 0.00/338M [00:00<?, ?iB/s]  1%|▎                                     | 2.64M/338M [00:00<00:12, 27.5MiB/s]  5%|█▋                                    | 15.5M/338M [00:00<00:03, 88.5MiB/s]  8%|███▏                                   | 27.6M/338M [00:00<00:03, 106MiB/s] 11%|████▎                                  | 37.8M/338M [00:00<00:02, 106MiB/s] 14%|█████▍                                | 47.9M/338M [00:00<00:03, 87.0MiB/s] 17%|██████▎                               | 56.6M/338M [00:00<00:04, 70.3MiB/s] 19%|███████▏                              | 64.0M/338M [00:00<00:05, 56.8MiB/s] 21%|███████▉                              | 70.1M/338M [00:01<00:05, 50.1MiB/s] 22%|████████▍                             | 75.3M/338M [00:01<00:05, 46.8MiB/s] 24%|█████████                             | 80.1M/338M [00:01<00:06, 44.8MiB/s] 25%|█████████▌                            | 84.6M/338M [00:01<00:06, 44.0MiB/s] 26%|██████████                            | 88.9M/338M [00:01<00:06, 43.3MiB/s] 28%|██████████▍                           | 93.1M/338M [00:01<00:05, 43.1MiB/s] 29%|██████████▉                           | 97.6M/338M [00:01<00:05, 43.8MiB/s] 30%|███████████▊                           | 102M/338M [00:01<00:05, 44.5MiB/s] 32%|████████████▎                          | 107M/338M [00:02<00:05, 45.4MiB/s] 33%|████████████▉                          | 112M/338M [00:02<00:05, 46.4MiB/s] 35%|█████████████▍                         | 117M/338M [00:02<00:04, 47.6MiB/s] 36%|██████████████                         | 122M/338M [00:02<00:04, 48.9MiB/s] 38%|██████████████▋                        | 127M/338M [00:02<00:04, 49.8MiB/s] 39%|███████████████▎                       | 132M/338M [00:02<00:04, 51.3MiB/s] 41%|███████████████▉                       | 138M/338M [00:02<00:04, 52.2MiB/s] 43%|████████████████▌                      | 144M/338M [00:02<00:03, 53.8MiB/s] 44%|█████████████████▏                     | 149M/338M [00:02<00:03, 54.9MiB/s] 46%|█████████████████▉                     | 155M/338M [00:02<00:03, 56.5MiB/s] 48%|██████████████████▌                    | 161M/338M [00:03<00:03, 57.8MiB/s] 50%|███████████████████▎                   | 167M/338M [00:03<00:03, 59.0MiB/s] 51%|████████████████████                   | 173M/338M [00:03<00:02, 59.3MiB/s] 53%|████████████████████▊                  | 180M/338M [00:03<00:02, 60.8MiB/s] 55%|█████████████████████▌                 | 186M/338M [00:03<00:02, 62.3MiB/s] 57%|██████████████████████▎                | 193M/338M [00:03<00:02, 64.1MiB/s] 59%|███████████████████████                | 199M/338M [00:03<00:02, 65.4MiB/s] 61%|███████████████████████▊               | 206M/338M [00:03<00:02, 66.1MiB/s] 63%|████████████████████████▋              | 213M/338M [00:03<00:01, 67.7MiB/s] 65%|█████████████████████████▍             | 220M/338M [00:04<00:01, 69.3MiB/s] 67%|██████████████████████████▎            | 227M/338M [00:04<00:01, 70.7MiB/s] 70%|███████████████████████████            | 235M/338M [00:04<00:01, 71.1MiB/s] 72%|███████████████████████████▉           | 242M/338M [00:04<00:01, 73.2MiB/s] 74%|████████████████████████████▊          | 249M/338M [00:04<00:01, 73.9MiB/s] 76%|█████████████████████████████▋         | 257M/338M [00:04<00:01, 76.2MiB/s] 78%|██████████████████████████████▌        | 265M/338M [00:04<00:00, 77.1MiB/s] 81%|███████████████████████████████▍       | 273M/338M [00:04<00:00, 78.2MiB/s] 83%|████████████████████████████████▎      | 280M/338M [00:04<00:00, 71.9MiB/s] 85%|█████████████████████████████████▏     | 287M/338M [00:04<00:00, 67.9MiB/s] 87%|█████████████████████████████████▉     | 294M/338M [00:05<00:00, 65.6MiB/s] 89%|██████████████████████████████████▋    | 300M/338M [00:05<00:00, 63.9MiB/s] 91%|███████████████████████████████████▎   | 306M/338M [00:05<00:00, 64.0MiB/s] 92%|████████████████████████████████████   | 312M/338M [00:05<00:00, 63.8MiB/s] 94%|████████████████████████████████████▊  | 319M/338M [00:05<00:00, 64.2MiB/s] 96%|█████████████████████████████████████▌ | 325M/338M [00:05<00:00, 65.1MiB/s] 98%|██████████████████████████████████████▎| 332M/338M [00:05<00:00, 65.7MiB/s]100%|███████████████████████████████████████| 338M/338M [00:05<00:00, 61.1MiB/s]
List of prompts:
['This is a photo of a airplane',
 'This is a photo of a automobile',
 'This is a photo of a bird',
 'This is a photo of a cat',
 'This is a photo of a deer',
 'This is a photo of a dog',
 'This is a photo of a frog',
 'This is a photo of a horse',
 'This is a photo of a ship',
 'This is a photo of a truck']
Traceback (most recent call last):
  File "/home/lcur0649/uvadlc_practicals_2022/assignment2/part2/.//main.py", line 150, in <module>
    main()
  File "/home/lcur0649/uvadlc_practicals_2022/assignment2/part2/.//main.py", line 139, in main
    learn = Learner(args)
  File "/home/lcur0649/uvadlc_practicals_2022/assignment2/part2/learner.py", line 56, in __init__
    self.vpt = CustomCLIP(args, self.test_dataset, template=PROMPT_TEMPLATE)
  File "/home/lcur0649/uvadlc_practicals_2022/assignment2/part2/vpt_model.py", line 88, in __init__
    text_features = clip_model.encode_text(text)
NameError: name 'text' is not defined. Did you mean: 'next'?
